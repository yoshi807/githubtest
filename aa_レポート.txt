
# 概要
- 2019/5/14にWindowsのリモートデスクトップサービスの脆弱性（BlueKeep）が公開されました。
- 本脆弱性は、サポート切れのWeindowOSからパッチが出されるほど危険な脆弱性だといわれていました。猛威を奮った「WannaCry」の再来と言われており、５月公開時点で２か月で攻撃が発生するといわれていました。
- 現在公開から2〜3か月経過しており、日本での報道が収束傾向にあるなか、ここ１か月の攻撃や脅威の動向を調査しました。また、現在公開されているPOC【※1】を試行しました。

# 脆弱性概要
- 2017年5月12日、世界中の企業や組織をパニックに陥れたWannaCry。コンピューターが次々と感染していき、画面に身代金要求文が表示されたことはいまだ記憶に残っている方もいると思います。
- 本脆弱性は、ワームのようなふるまいをすることも可能であり、極めて危険な存在といえます。このBlueKeepは、リモートデスクトップサービスに存在する、リモートコード実行 (RCE) における重大な脆弱性を悪用し、マルウェアを拡散させる可能性を有している。

# 調査結果
## 残存状況
- 世界で80万台以上のWindowsシステムが依然としてBlueKeepの脆弱性にさらされている。まだ多くの機器に対してパッチがあたっていない状況。  

## 攻撃動向
- 2019年7月DDOS攻撃で対象機器をブルースクリーンにさせる攻撃データがある（5月より公開済み）であるが、攻撃者は現在公開されていない。    
- Sophosでは、Windowsのマルウェアをインストールすることなくリモートシステムを完全に制御できます。脆弱性をトリガーして管理者特権のコマンドシェル(システム・レベルの権限#システムレベルノケンゲン#)への接続を確立するスクリプトの試みを示しています。この動画では研究者がそのコマンドシェルを起動し、有効な認証情報を必要とせずにマシンを完全に制御する様子が示されている。
-- 動画のリンク
- 攻撃者のコミュニティにはすでに攻撃コードが出回っている可能性があり、攻撃はまだ検出されていない。
- Immunity社の商用ペンテストツール"CANVAS"にBlueKeepのエクスプロイトが追加されたようです?
- 2019/7/31時点で公開されるケースがあったが公開。本脆弱性を試すには数弱また、偽の攻撃コードを販売するなどのケースが発生
- 攻撃の引き金になるといわれている、脆弱性を突くエクスプロイトが公開。7月23日、Immunity Inc.はBlueKeepのエクスプロイトを同社のペンテスト用ツールキットCANVAS v 7.23に組み込んだと発表した。(※14) 
- 過去には、オープンなRDPサービスをオンラインで公開していれば、リモートのWindowsシステムをクラッシュさせる可能性のあるBlueKeepのエクスプロイトがGitHubにアップロードされていた。
- ImmunityのCANVAS BlueKeepモジュールは、リモートでコードを実行することができます。つまり、感染したホスト上でシェルを開くことができます。

# 検証結果
- 世界では数々の研究者がPOCを公開している。以下の通り検証を行いました。
-- 攻撃コードもフィッシング的なものも公開されている

## 環境構築
- POCについて検証を行ってみました。

### 実行結果
- 検証は行っていませんが、最新のモジュールでは検証が可能です。
- ああああああああああああああああああああ
- 在のPoCを試していくつか分かったこととし

# まとめ


# 参考資料
20190701「No Public BlueKeep Exploit Yet, But Clock is Ticking」  
https://duo.com/decipher/no-public-bluekeep-exploit-yet-but-clock-is-ticking

- まだ公開BLUEKEEPの悪用はないが、時計は刻々と過ぎている
- 何人かの研究者が独自の実用的な概念実証を開発しているが、このエクスプロイトを公表したり、自分たちがしたことの詳細を議論することを控えている。
- このような寡黙な態度は異例であり、攻撃者がエクスプロイトコードを公開している脆弱性を標的にしていることを示すデータがあるため、詳細を公開するのを控えている 
- Windowsをクラッシュさせブルースクリーンエラーを引き起こす可能性のあるパブリックコードは存在。研究者らはこの脆弱性を悪用する別の方法を示している。
- Sophoshosは、SophosLabsのOffensive Researchチームが開発したエクスプロイトを示すビデオを公開
- このエクスプロイトは完全にファイルレスで動作し、マルウェアをインストールすることなくリモートシステムを完全に制御できる。
- ターゲットのWindows7仮想マシンに対してRDPセッションを開始し、脆弱性をトリガーして管理者特権のコマンドシェル(システム・レベルの権限#システムレベルノケンゲン#)への接続を確立するスクリプトの試みを示しています。この動画では、研究者がそのコマンドシェルを起動し、

20190701 RDP に存在する脆弱性を狙う「BlueKeep」エクスプロイト
https://nakedsecurity.sophos.com/ja/2019/07/01/rdp-bluekeep-exploit-shows-why-you-really-really-need-to-patch/

- 5 月の月例パッチで示された唯一の希望は、CVE-2019-0708 の悪用が困難であったことです。そのおかげで、企業は攻撃者が悪用方法を発見する前に、BlueKeep の問題を修正するパッチを適用することができました。また、リバースエンジニアリングするには難しすぎるのではないかともと言われていました。
- しかし、その希望も長くは続きませんでした。
- CVE-2019-0708 が公開されて以降、少数の企業やセキュリティ研究者がこの脆弱性を悪用する方法を発見したと主張しています。そうした企業の 1 つがソフォスです。
- ソフォスは本日、独自の CVE-2019-0708 エクスプロイトの PoC（概念実証）（リンク先: 英語）の存在を明らかにしました。
CVE-2019-0708 が公開されて以降、少数の企業やセキュリティ研究者がこの脆弱性を悪用する方法を発見したと主張しています。
- そうした企業の 1 つがソフォスです。ソフォスは本日、独自の CVE-2019-0708 エクスプロイトの PoC（概念実証）（リンク先: 英語）の存在を明らかにしました。
- BlueKeep の命名者でメガスレッドの管理人でもある Kevin Beaumont 氏が Twitter で「驚くべき」と表現したこの PoC は、SophosLabs Offensive Security チームによって作成されました。
- 言うまでもなくこのコードは危険であるため、一般には公開できません。そこで SophosLabs は、認証なしでリモートシステムを完全制御できるこのファイルレス攻撃を説明したビデオを作成しました。

20190701 BlueKeep PoCがリモートデスクトップの不正利用の危険性を実証
https://news.sophos.com/en-us/2019/07/01/bluekeep-poc-demonstrates-risk-of-remote-desktop-exploit/

- 十分な注意を払ってもPoCを一般に公開することはありません。
- 他の何人かのセキュリティアナリストがすでに彼ら自身の概念実証コードを公開していますが、その公開コード（誰でもが知っている限り）はWindowsをクラッシュさせることしかできず、「ブルースクリーンオブデス」（BSOD）エラーを引き起こします。このタイプの攻撃では、再起動するまでコンピュータは使用できなくなります。技術的には、サービス拒否攻撃の一種です。
- 我々が構築した方法はDoSだけではありません。エクスプロイトコードを実行した後、仮想の攻撃者はWindowsのログイン画面にログイン前に表示されるコマンドシェルを起動することができます。

https://twitter.com/GossiTheDog/status/1145606792619143168
- ソフォスは、Windowsのアクセシビリティのショートカットを変更する信じられないほどの#BlueKeepエクスプロイト（非公開）を作成しました。そのため、RDPログイン画面をバイパスしてGUIセッションを取得することができます。


20190711 新たな「WannaCryptor」になるかもしれない脆弱性「BlueKeep」とは？  
https://ascii.jp/elem/000/001/890/1890827/

- 今回発見された、BlueKeepと呼ばれる脆弱性は、ワームのようなふるまいをすることも可能であり、極めて危険な存在といえる。このBlueKeepは、リモートデスクトップサービスに存在する、リモートコード実行 (RCE) における重大な脆弱性を悪用し、マルウェアを拡散させる可能性を有している。5月14日以降、マイクロソフト社はサポート対象（一部、サポート対象外も含む）のOS向けにこの脆弱性を修正するパッチの配布を開始した。
- BlueKeepは、リモートデスクトップサービス（旧称、ターミナルサービス）内で発見された。もし悪用されると、認証情報やユーザーとのやり取りなしに、バックドア経由で標的のコンピューターにアクセスできてしまう。
さらに厄介となるのは、この脆弱性が「ワームの侵入を招く」ということだ。つまり、今後発生するエクスプロイトがこの脆弱性を悪用し、WannaCryptorと同様にネットワークの内外でマルウェアを拡散させる懸念がある。 
- 　マイクロソフト社が今回、最新のパッチをリリースした後、セキュリティ研究員は実用的なPoCをいくつか作成している。しかし、本稿執筆時点で、いずれも公開されておらず、このバグが実際にユーザー環境で悪用されているのかどうかは不明なところである。
- ワームの侵入を許してしまうBlueKeepの特性を考慮すると、同様の事態が起きる可能性は払拭できない。誰かが実際に動作するエクスプロイトを公開したり、マルウェア作成者がそれを闇市場で販売したり、となるのももはや時間の問題でしかないのかもしれない。仮にそうした事態が起きれば、スキルレベルが低いサイバー犯罪者への拡散を招き、その売買などが犯罪者の資金源となると見られている。

20190713「InSecurity Podcast: BlueKeep - It’s Not Just About the Worm 
https://threatvector.cylance.com/en_us/home/insecurity-podcast-bluekeep-its-not-just-about-the-worm.html

20190717「BlueKeep blues: More than 800,000 systems still unpatched」 
https://searchsecurity.techtarget.com/news/252466932/BlueKeep-blues-More-than-800000-systems-still-unpatched

>BlueKeepパッチの傾向
BitSightの報告書によると、BlueKeepにさらされているシステムの数は、いくつかの国で「顕著な減少が示された」という。たとえば、中国では脆弱なシステムの数が109,670減少し(ビットサイト社の前回の報告から24%近く減少した)、米国では脆弱なシステムの数が26,787、つまり約20.3%減少しました。
BitSightはまた、業界別にパッチのトレンドを分析した。報告書によると、5月31日以降、脆弱性の高いシステムが最も減少した産業は、合法(32.9%)、非営利/NGO(27.1%)、航空宇宙/防衛(24.1%)だった。脆弱なシステムで最も小さな減少を示した産業は、消費財(5.3%)、公益事業(9.5%)、技術(9.5%)であった。
さらにBitSightは、各業界のBlueKeepへの全体的なエクスポージャーを測定した。法律、保険、金融が最も脆弱性にさらされておらず、通信と教育が最も脆弱性にさらされており、技術、公共事業、政府/政治がこれに続いた。

20190718「Despite BlueKeep Warnings, Many Organizations Fail to Patch」  
https://www.bankinfosecurity.com/despite-bluekeep-warnings-many-organizations-fail-to-patch-a-12795
- BitSightレポートは、MicrosoftがWindows XP、Windows 7、Windows Server 2000、Windows Server 2003、Windows Serverなど、サポートしていないオペレーティングシステム用のパッチを公開した5月以来、他のセキュリティ会社が見てきた遅いパッチ傾向を反映している。 

90723「BlueKeep warning: Exploit might come soon?」  
https://borncity.com/win/2019/07/23/bluekeep-warning-exploit-might-come-soon/
- 日中に北京で開催されたセキュリティ会議で、講演者はリモートデスクトップサービスの脆弱性CVE-2019-0708（BlueKeep）について話し、実用的な悪用の概念を発表しました。

20190724「Immunity starts selling exploit for Microsoft RDP flaw」  
https://www.itwire.com/security/immunity-starts-selling-exploit-for-microsoft-rdp-flaw.html
- ImmunityがこのRCEエクスプロイトを販売していた事実は、英国のセキュリティ研究者Kevin Beaumontによって明らかにされ、彼は「アメリカの企業が#BlueKeepのためにRCEのエクスプロイトを販売している。」とツイートした。
この脆弱性をBluekeepと名付けたのは、iTWireをはじめとするさまざまなメディアで頻繁に引用されているBeaumont氏だ。
同氏はまた、この脆弱性に対応するスキャナの開発状況を追跡しており、ここにリストを掲載している。
- https://opensecurity.global/forums/topic/23-bluekeep-rdp-vulnerability-exploitation-tracking/

14)20190725「US company selling weaponized BlueKeep exploit」  
https://www.zdnet.com/article/us-company-selling-weaponized-bluekeep-exploit/

- 過去には、オープンなRDPサービスをオンラインで公開していれば、リモートのWindowsシステムをクラッシュさせる可能性のあるBlueKeepのエクスプロイトがGitHubにアップロードされていた。ImmunityのCANVAS BlueKeepモジュールは、リモートでコードを実行することができます。つまり、感染したホスト上でシェルを開くことができます。

20190729  Fearing WannaCry-Level Danger, Enterprises Wrestle with BlueKeep
https://threatpost.com/fearing-wannacry-level-danger-enterprises-wrestle-with-bluekeep/146727/

- セキュリティ研究者らによると、エクスプロイトの作成は困難で、多くの場合RCEではなくターゲットマシンのクラッシュやDoS攻撃につながるという。しかし、中には実用的なエクスプロイト(国土安全保障省を含む)を作成できるものもあるが、一般の人々を保護するために詳細については口をつぐんでいる。
- 先週、セキュリティー企業を通じて、攻撃者がリモートでコードを実行し、RDPを使って他のマシンを攻撃するワームを作成することを可能にするエクスプロイトが販売された。
Immunity Inc.はTwitterで、同社の自動悪用プラットフォームCANVASにBlueKeepエクスプロイトモジュールを追加したと述べた。CANVASはサブスクリプション形式で提供されている(高い月額料金にもかかわらず)。
- CVE-2019-0708のパッチは5月に登場した。BlueKeepに関する懸念は非常に大きいため、Microsoftは 「Windows XP」 と 「Windows2003」 にパッチを配布するという異例の措置を講じたほどだ。同社はまた、管理者にパッチの適用を促す複数の追加勧告を出している。ただし、パッチ適用プロセスは低速です。
BlueKeepに脆弱性のあるシステムは、7月2日時点で約805,665台がオンラインに残っている (同社の最新ステータスアップデートによると、5月の100万台から減少している)。
影響を受けやすいシステムの数は、パッチが適用されたまま外部にさらされている92,082システムを含め、5月31日と比較して17.18%(167,164システム)減少しています。これは、パッチ適用、オフライン化、および交換の間に、脆弱性にさらされているシステムが平均で5,224台/日減少することを意味します。
つまり、研究者らによると、セキュリティへの取り組みは十分なスピードでは進んでいないという。

20190727 BlueKeep is Bound to Get Weaponized Soon as an RCE PoC Just Got Released  
https://www.technadu.com/bluekeep-rce-poc-released/74927/

- これまでのところ、悪意のある行為者は、RCEの脆弱性を利用してBlueKeepを兵器化し、世界規模の感染を引き起こすワーム攻撃を仕掛ける能力を実証していない。サイバーセキュリティの専門家や組織、さらには政府機関でさえ、この脆弱性の影響を受けやすい旧式のシステムがまだ何万台も存在することから、状況がしばらく変わらないことを望んでいた。しかし、「イミュニティ。」と呼ばれるペンテストの専門家が、BlueKeepを悪用するモジュールに関する概念証明(位置C)コードを公開したため、「待機」の時代は終わった。次のビデオで見られるように、Immunityはリモートコード実行シナリオがどのように機能するかを示しているので、これまでGitHubで浮上していたRDPのエクスプロイテーションとは似ても似つかない。
- Immunityのモジュールは自己増殖しないので、現在はワームとして動作していない。このサイバーセキュリティ専門家は、侵入テストのため、Canvasを通じてPython PoCを販売している。当然のことながら、PoCのリリースは、コードがダークネットのチャンネルにリークし、その結果BlueKeepワームが開発されるのではないかと恐れるサイバーセキュリティ研究者たちに懸念を引き起こした。しかし、Immunityが誰が自分のエクスプロイトを購入するかを管理しており、一般のエクスプロイトはImmunityのPoCがリークされるよりも早く開発される可能性があると指摘する人もいる。

- いずれにしても、BlueKeepの脆弱性が、悪意ある人物によってすぐに武器化されることは間違いない。とはいえ、現時点でこの脅威に対処する唯一の方法は、脆弱なシステムにパッチを当てることだ。今月初めには、これらのシステムは約80万台と推定されているため、この部分にはまだ多くの作業が残っています。複数の情報源によると、インターネットをスキャンしてBlueKeepの脆弱なシステムを探しているアクターが増えている一方で、ボットネットキャンペーンの数が増加しているため、BlueKeepのスキャナがマルウェアに追加されています。

20190730 BlueKeep Exploits Appear as Security Firms Continue to Worry About Cyberattack
https://www.darkreading.com/bluekeep-exploits-appear-as-security-firms-continue-to-worry-about-cyberattack/d/d-id/1335380 

- 壊滅的なワームは明らかな脅威だが、もっと微妙な危険も存在すると、米ビットサイト社のセキュリティー研究責任者、ダン・ダールバーグ氏は言う。
- 「この脆弱性を悪用して悪質な情報を得ようとする人々の行動を考えてみてください。経験の浅い人は、ワームに変える可能性があります。」と彼は言う。「しかし、この脆弱性をより密かに利用する可能性のある関係者は他にも存在し、それを検出するのははるかに困難になるだろう。」

20190731 CVE-2019-0708 “Bluekeep”: Immunity Inc. starts to sell a exploit with full RCE capabilities
- サイバーセキュリティ会社のImmunity Inc.は、侵入テストツールキットの一部として、フルリモートコード実行が可能なBlueKeepエクスプロイトモジュールを販売することを決定しました。
- サイバーセキュリティベンダーのImmunity Inc.は、侵入テストツールキットの一部として、完全なリモートコード実行が可能なBlueKeepエクスプロイトモジュールを販売することを決定しました。









## Twitter
Immunity Inc.  
https://twitter.com/immunityinc/status/1153752470130221057

- 新しいリリース -  CANVAS 7.23：このリリースはRDPエクスプロイトのための新しいモジュール、BLUEKEEPを特徴としています。こちらのビデオデモをご覧ください。

## POC